<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>打卡日历控件小记</title>
    <link href="/2022/07/07/%E6%89%93%E5%8D%A1%E6%97%A5%E5%8E%86%E6%8E%A7%E4%BB%B6%E5%B0%8F%E8%AE%B0/"/>
    <url>/2022/07/07/%E6%89%93%E5%8D%A1%E6%97%A5%E5%8E%86%E6%8E%A7%E4%BB%B6%E5%B0%8F%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h3 id="日历控件"><a href="#日历控件" class="headerlink" title="日历控件"></a>日历控件</h3><ul><li>日期处理<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs qml"><span class="hljs-keyword">import</span> dayjs from <span class="hljs-string">&#x27;dayjs&#x27;</span>;<br><br><span class="hljs-comment">/** 月日历日期处理 */</span><br><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calendarTable</span>(<span class="hljs-params">date: string</span>) </span>&#123;<br>  <span class="hljs-keyword">let</span> <span class="hljs-attribute">yearMonthDay</span>: any = <span class="hljs-built_in">date</span>.split(<span class="hljs-string">&#x27;-&#x27;</span>);<br>  <span class="hljs-comment">// console.log(date, yearMonthDay);</span><br>  <span class="hljs-comment">//当月天数</span><br>  <span class="hljs-keyword">const</span> thisMonthDays = dayjs(<span class="hljs-built_in">date</span>).daysInMonth();<br>  <span class="hljs-comment">//当月一号是星期几</span><br>  <span class="hljs-keyword">const</span> thisDateWeek = dayjs(<span class="hljs-built_in">date</span>).date(<span class="hljs-number">1</span>).day();<br>  <span class="hljs-comment">// let maxTableRow = 0//列固定7列，这是当月最大行数</span><br>  <span class="hljs-comment">// 日历存放</span><br>  <span class="hljs-keyword">let</span> <span class="hljs-attribute">calendarArr</span>: any = [];<br>  <span class="hljs-comment">//往日历数组装每天的日期</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; thisMonthDays + <span class="hljs-number">1</span>; i++) &#123;<br>    calendarArr.push(yearMonthDay[<span class="hljs-number">0</span>] + <span class="hljs-string">&#x27;-&#x27;</span> + yearMonthDay[<span class="hljs-number">1</span>] + <span class="hljs-string">&#x27;-&#x27;</span> + (i &lt; <span class="hljs-number">10</span> ? <span class="hljs-string">&#x27;0&#x27;</span> + <span class="hljs-attribute">i</span> : i))<br>  &#125;<br>  <span class="hljs-comment">// console.log(thisDateWeek);</span><br><br>  <span class="hljs-comment">// 有当月一号是星期几根据规则往前面补空位</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">1</span>; j &lt; thisDateWeek; j++) &#123;<br>    calendarArr.unshift(<span class="hljs-string">&#x27;&#x27;</span>)<br>  &#125;<br>  <span class="hljs-comment">// 表格列数固定为7列，获取最大行数</span><br>  <span class="hljs-keyword">let</span> len = calendarArr.length;<br>  <span class="hljs-keyword">let</span> arrRow = <span class="hljs-built_in">Math</span>.ceil(len / <span class="hljs-number">7</span>);<br>  <span class="hljs-comment">// maxTableRow = arrRow;</span><br>  <span class="hljs-comment">// 获取整个表格的格子个数，给多余的格子补空</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> k = <span class="hljs-number">0</span>; k &lt; arrRow * <span class="hljs-number">7</span> - len; k++) &#123;<br>    calendarArr.push(<span class="hljs-string">&#x27;&#x27;</span>)<br>  &#125;<br>  <span class="hljs-comment">// setDateArr(calendarArr)</span><br>  <span class="hljs-keyword">return</span> calendarArr<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li>页面数据<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Taro</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@tarojs/taro&#x27;</span><br><span class="hljs-keyword">import</span> &#123; useEffect, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">View</span>, <span class="hljs-title class_">Text</span>, &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@tarojs/components&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Swiper</span>, <span class="hljs-title class_">ActionSheet</span>, <span class="hljs-title class_">Empty</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@taroify/core&quot;</span><br><span class="hljs-keyword">import</span> dayjs <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;dayjs&#x27;</span><br><span class="hljs-keyword">import</span> &#123;<br>  <span class="hljs-title class_">Location</span>, <span class="hljs-title class_">Checked</span>, <span class="hljs-title class_">ArrowUp</span>, <span class="hljs-title class_">ArrowDown</span>, <span class="hljs-title class_">Arrow</span><br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@taroify/icons&quot;</span><br><span class="hljs-comment">// import lunar from &#x27;../../../utils/lunar&#x27;</span><br><span class="hljs-keyword">import</span> &#123; toChineseNum &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../utils/utools&#x27;</span><br><span class="hljs-keyword">import</span> &#123; calendarTable &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./export&#x27;</span><br><span class="hljs-keyword">import</span> &#123; getQueueMonth, workDateRecord &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../export&#x27;</span><br><span class="hljs-comment">// import attendanceServer from &#x27;../../../services/common/attendance&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;./index.scss&#x27;</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Index</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-comment">// 左右切换月份下标标识</span><br>  <span class="hljs-keyword">const</span> [cur, setCur] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)<br>  <span class="hljs-comment">// 周模式与月模式</span><br>  <span class="hljs-keyword">const</span> [<span class="hljs-keyword">type</span>, setType] = useState&lt;<span class="hljs-string">&#x27;week&#x27;</span> | <span class="hljs-string">&#x27;month&#x27;</span>&gt;(<span class="hljs-string">&#x27;month&#x27;</span>)<br>  <span class="hljs-keyword">const</span> [today] = <span class="hljs-title function_">useState</span>(<span class="hljs-title function_">dayjs</span>().<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>))<span class="hljs-comment">//当前时间</span><br>  <span class="hljs-keyword">const</span> [pickday, setPickday] = <span class="hljs-title function_">useState</span>(<span class="hljs-title function_">dayjs</span>().<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>))<span class="hljs-comment">//当前时间</span><br>  <span class="hljs-comment">// const [showDate, setShowDate] = useState(dayjs().format(&#x27;YYYY-MM&#x27;)) //标题展示时间</span><br>  <span class="hljs-keyword">const</span> [dateArr, setDateArr] = <span class="hljs-title function_">useState</span>([])<span class="hljs-comment">//月日期数组</span><br>  <span class="hljs-keyword">const</span> [weeksArr, setWeeksArr] = <span class="hljs-title function_">useState</span>([])<span class="hljs-comment">//周日期数组</span><br>  <span class="hljs-keyword">const</span> weekArr = [<span class="hljs-string">&#x27;一&#x27;</span>, <span class="hljs-string">&#x27;二&#x27;</span>, <span class="hljs-string">&#x27;三&#x27;</span>, <span class="hljs-string">&#x27;四&#x27;</span>, <span class="hljs-string">&#x27;五&#x27;</span>, <span class="hljs-string">&#x27;六&#x27;</span>, <span class="hljs-string">&#x27;日&#x27;</span>]<span class="hljs-comment">//星期数组</span><br>  <span class="hljs-keyword">const</span> checkArr = [<span class="hljs-string">&#x27;2022-05-28&#x27;</span>, <span class="hljs-string">&#x27;2022-08-28&#x27;</span>, <span class="hljs-string">&#x27;2022-08-27&#x27;</span>, <span class="hljs-string">&#x27;2022-06-01&#x27;</span>,]<span class="hljs-comment">//标记日期</span><br>  <span class="hljs-keyword">const</span> noArr = [<span class="hljs-string">&#x27;2022-07-22&#x27;</span>, <span class="hljs-string">&#x27;2022-08-23&#x27;</span>,]<span class="hljs-comment">//标记日期</span><br>  <span class="hljs-comment">// 异常控件</span><br>  <span class="hljs-keyword">const</span> [open, setOpen] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>)<br>  <span class="hljs-comment">// 周切换标识日期</span><br>  <span class="hljs-keyword">const</span> [weekDay, setWeekDay] = <span class="hljs-title function_">useState</span>(<span class="hljs-title function_">dayjs</span>().<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>))<br>  <span class="hljs-comment">// 排班情况</span><br>  <span class="hljs-keyword">const</span> [queueInfo, setQueueInfo] = useState&lt;<span class="hljs-built_in">any</span>&gt;([])<br>  <span class="hljs-comment">//某天打卡记录</span><br>  <span class="hljs-keyword">const</span> [dakaRecord, setDakaRecord] = useState&lt;<span class="hljs-built_in">any</span>&gt;()<br><br>  <span class="hljs-comment">// 获取周日历</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getWeekArr</span> = (<span class="hljs-params">w</span>) =&gt; &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">getWeek</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">let</span> <span class="hljs-attr">daysList</span>: <span class="hljs-built_in">any</span> = [];<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">8</span>; i++) &#123;<br>        daysList.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">dayjs</span>(w).<span class="hljs-title function_">startOf</span>(<span class="hljs-string">&#x27;week&#x27;</span>).<span class="hljs-title function_">add</span>(i, <span class="hljs-string">&#x27;day&#x27;</span>).<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>));<br>      &#125;<br>      <span class="hljs-keyword">return</span> daysList;<br>    &#125;<br>    <span class="hljs-title function_">setWeeksArr</span>(<span class="hljs-title function_">getWeek</span>())<br>  &#125;<br><br>  <span class="hljs-comment">// 获取月日历</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getMonthArr</span> = (<span class="hljs-params">m</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-attr">arr</span>: <span class="hljs-built_in">any</span> = <span class="hljs-title function_">calendarTable</span>(<span class="hljs-title function_">dayjs</span>(m).<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>))<br>    <span class="hljs-title function_">setDateArr</span>(arr)<br>  &#125;<br><br>  <span class="hljs-comment">// 数字时间</span><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">numTime</span>(<span class="hljs-params">h, m</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">dayjs</span>(<span class="hljs-title function_">dayjs</span>().<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>)).<span class="hljs-title function_">add</span>(h, <span class="hljs-string">&#x27;hour&#x27;</span>).<span class="hljs-title function_">add</span>(m, <span class="hljs-string">&#x27;minute&#x27;</span>).<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;HH:mm&#x27;</span>)<br>  &#125;<br><br>  <span class="hljs-comment">// 监听选定的天数</span><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// getQueueMonth(pickday)</span><br>    <span class="hljs-title function_">getQueueMonth</span>(pickday, <span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res, <span class="hljs-string">&#x27;当月打卡班次&#x27;</span>);<br>      <span class="hljs-title function_">setQueueInfo</span>(res.<span class="hljs-property">result</span>)<br>    &#125;)<br>    <span class="hljs-title function_">workDateRecord</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res, <span class="hljs-string">&#x27;某一天打卡记录&#x27;</span>);<br>      <span class="hljs-title function_">setDakaRecord</span>(res)<br>    &#125;, pickday)<br>  &#125;, [pickday])<br><br>  <span class="hljs-comment">// 周变化</span><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">getWeekArr</span>(weekDay)<br>  &#125;, [weekDay])<br><br>  <span class="hljs-comment">//回到今天</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">backToToday</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&#x27;week&#x27;</span>) &#123;<br>      <span class="hljs-title function_">getWeekArr</span>(today)<br>      <span class="hljs-title function_">setPickday</span>(today)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">const</span> <span class="hljs-attr">arr</span>: <span class="hljs-built_in">any</span> = <span class="hljs-title function_">calendarTable</span>(<span class="hljs-title function_">dayjs</span>(today).<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>))<br>      <span class="hljs-title function_">setDateArr</span>(arr)<br>      <span class="hljs-title function_">setPickday</span>(today)<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">// 周和月切换</span><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&#x27;week&#x27;</span>) &#123;<br>      <span class="hljs-title function_">getWeekArr</span>(pickday)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">getMonthArr</span>(pickday)<br>    &#125;<br>  &#125;, [<span class="hljs-keyword">type</span>])<br><br>  <span class="hljs-comment">//上个月zhou</span><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">prevMonth</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&#x27;week&#x27;</span>) &#123;<br>      <span class="hljs-keyword">const</span> w = <span class="hljs-title function_">dayjs</span>(weekDay).<span class="hljs-title function_">subtract</span>(<span class="hljs-number">7</span>, <span class="hljs-string">&#x27;day&#x27;</span>).<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>)<br>      <span class="hljs-title function_">setWeekDay</span>(w)<br>      <span class="hljs-keyword">let</span> weekStart = <span class="hljs-title function_">dayjs</span>(w).<span class="hljs-title function_">startOf</span>(<span class="hljs-string">&#x27;week&#x27;</span>).<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;day&#x27;</span>).<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>);<br>      <span class="hljs-title function_">setPickday</span>(weekStart)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">let</span> date = <span class="hljs-title function_">dayjs</span>(pickday).<span class="hljs-title function_">subtract</span>(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;months&#x27;</span>).<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>);<br>      <span class="hljs-keyword">const</span> <span class="hljs-attr">arr</span>: <span class="hljs-built_in">any</span> = <span class="hljs-title function_">calendarTable</span>(date)<br>      <span class="hljs-title function_">setPickday</span>(<span class="hljs-title function_">dayjs</span>(date).<span class="hljs-title function_">date</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>))<br>      <span class="hljs-title function_">setWeekDay</span>(<span class="hljs-title function_">dayjs</span>(date).<span class="hljs-title function_">date</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>))<br>      <span class="hljs-title function_">setDateArr</span>(arr)<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">// 下一月周</span><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">nextMonth</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&#x27;week&#x27;</span>) &#123;<br>      <span class="hljs-keyword">const</span> w = <span class="hljs-title function_">dayjs</span>(weekDay).<span class="hljs-title function_">add</span>(<span class="hljs-number">7</span>, <span class="hljs-string">&#x27;day&#x27;</span>).<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>)<br>      <span class="hljs-title function_">setWeekDay</span>(w)<br>      <span class="hljs-keyword">let</span> weekStart = <span class="hljs-title function_">dayjs</span>(w).<span class="hljs-title function_">startOf</span>(<span class="hljs-string">&#x27;week&#x27;</span>).<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;day&#x27;</span>).<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>)<br>      <span class="hljs-title function_">setPickday</span>(weekStart)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">let</span> date = <span class="hljs-title function_">dayjs</span>(pickday).<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;months&#x27;</span>).<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>)<br>      <span class="hljs-keyword">const</span> <span class="hljs-attr">arr</span>: <span class="hljs-built_in">any</span> = <span class="hljs-title function_">calendarTable</span>(date)<br>      <span class="hljs-title function_">setPickday</span>(<span class="hljs-title function_">dayjs</span>(date).<span class="hljs-title function_">date</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>))<br>      <span class="hljs-title function_">setWeekDay</span>(<span class="hljs-title function_">dayjs</span>(date).<span class="hljs-title function_">date</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>))<br>      <span class="hljs-title function_">setDateArr</span>(arr)<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">// 左右切换月份</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onChange</span> = (<span class="hljs-params">val</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> result = val - cur<br>    <span class="hljs-title function_">setCur</span>(val)<br>    <span class="hljs-keyword">if</span> ([<span class="hljs-number">1</span>, -<span class="hljs-number">2</span>].<span class="hljs-title function_">includes</span>(result)) &#123;<br>      <span class="hljs-title function_">nextMonth</span>()<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">prevMonth</span>()<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">// 点击日期</span><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">pickDate</span>(<span class="hljs-params">val</span>) &#123;<br>    <span class="hljs-comment">// console.log(toLunar(val),&#x27;农历&#x27;);</span><br>    <span class="hljs-title function_">setPickday</span>(val)<br>  &#125;<br><br>  <span class="hljs-comment">// const toLunar = (item) =&gt; &#123;</span><br>  <span class="hljs-comment">//   const y = dayjs(item).format(&#x27;YYYY&#x27;)</span><br>  <span class="hljs-comment">//   const m = dayjs(item).format(&#x27;MM&#x27;)</span><br>  <span class="hljs-comment">//   const d = dayjs(item).format(&#x27;DD&#x27;)</span><br>  <span class="hljs-comment">//   return lunar.solar2lunar(Number(y), Number(m), Number(d))</span><br>  <span class="hljs-comment">// &#125;</span><br><br>  <span class="hljs-comment">// 周和月切换</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">switchDate</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&#x27;week&#x27;</span>) &#123;<br>      <span class="hljs-title function_">setType</span>(<span class="hljs-string">&#x27;month&#x27;</span>)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">setType</span>(<span class="hljs-string">&#x27;week&#x27;</span>)<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">// 处理单独日期</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">dateItem</span> = (<span class="hljs-params">item</span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;dateitem&#x27;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> pickDate(item)&#125;&gt;</span><br><span class="language-xml">        &#123;</span><br><span class="language-xml">          item === today ? <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;item</span> === <span class="hljs-string">pickday</span> ?</span></span><br><span class="hljs-tag"><span class="language-xml">            &#x27;<span class="hljs-attr">active</span>&#x27; <span class="hljs-attr">:</span> &#x27;<span class="hljs-attr">circle</span>&#x27;&#125;&gt;</span>今<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span> : (</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;item</span> === <span class="hljs-string">pickday</span> ? &#x27;<span class="hljs-attr">active</span>&#x27; <span class="hljs-attr">:</span> &#x27;&#x27;&#125;&gt;</span>&#123;item &amp;&amp; Number(item.split(&#x27;-&#x27;)[2])&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span><br><span class="language-xml">          )</span><br><span class="language-xml">        &#125;</span><br><span class="language-xml">        &#123;</span><br><span class="language-xml">          checkArr.includes(item) &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;checkBadge&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        &#125;</span><br><span class="language-xml">        &#123;</span><br><span class="language-xml">          noArr.includes(item) &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;noBadge&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        &#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>    )<br>  &#125;<br><br>  <span class="hljs-comment">// 日历显示与滑动</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">swiperDate</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;calendarWatch&#x27;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;dateBox&quot;</span>&gt;</span></span><br><span class="language-xml">            &#123;</span><br><span class="language-xml">              weekArr.map(item =&gt; &#123;</span><br><span class="language-xml">                return (</span><br><span class="language-xml">                  <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;tableCol&quot;</span>&gt;</span></span><br><span class="language-xml">                    &#123;item&#125;</span><br><span class="language-xml">                  <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">                )</span><br><span class="language-xml">              &#125;)</span><br><span class="language-xml">            &#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;type</span> === <span class="hljs-string">&#x27;week&#x27;</span> ? &quot; <span class="hljs-attr">dateBox</span> <span class="hljs-attr">hide</span>&quot; <span class="hljs-attr">:</span> &#x27;<span class="hljs-attr">dateBox</span> <span class="hljs-attr">show</span>&#x27;&#125;&gt;</span></span><br><span class="language-xml">            &#123;</span><br><span class="language-xml">              (type === &#x27;week&#x27; ? weeksArr : dateArr).map((item: any, index: any) =&gt; &#123;</span><br><span class="language-xml">                return (</span><br><span class="language-xml">                  <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;index&#125;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; tableCol&quot;</span>&gt;</span></span><br><span class="language-xml">                    &#123;</span><br><span class="language-xml">                      dateItem(item)</span><br><span class="language-xml">                    &#125;</span><br><span class="language-xml">                  <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">                )</span><br><span class="language-xml">              &#125;)</span><br><span class="language-xml">            &#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/&gt;</span></span><br>    )<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">CustomDayCalendar</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;con&#x27;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;ctitle&#x27;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;showdate&#x27;</span>&gt;</span>&#123;pickday &amp;&amp; pickday&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;back&#x27;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;backToToday&#125;</span>&gt;</span>重置<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">          &#123;/* <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;prevMonth&#125;</span>&gt;</span> <span class="hljs-symbol">&amp;lt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span> */&#125;</span><br><span class="language-xml">          &#123;/* <span class="hljs-tag">&lt;<span class="hljs-name">Picker</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;showDate&#125;</span> <span class="hljs-attr">fields</span>=<span class="hljs-string">&#x27;month&#x27;</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">&#x27;date&#x27;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;onDateChange&#125;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;timeTitle&#x27;</span>&gt;</span></span><br><span class="language-xml">              &#123;showDate&#125;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">Picker</span>&gt;</span> */&#125;</span><br><span class="language-xml">          &#123;/* <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;nextMonth&#125;</span>&gt;</span> <span class="hljs-symbol">&amp;gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span> */&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Swiper</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;cur&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;onChange&#125;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;swp&quot;</span> &gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Swiper.Item</span>&gt;</span> &#123;swiperDate()&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Swiper.Item</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Swiper.Item</span>&gt;</span> &#123;swiperDate()&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Swiper.Item</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Swiper.Item</span>&gt;</span> &#123;swiperDate()&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Swiper.Item</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Swiper</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;morw&#x27;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;switchDate&#125;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;line&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">          &#123;</span><br><span class="language-xml">            type === &#x27;week&#x27; ? <span class="hljs-tag">&lt;<span class="hljs-name">ArrowDown</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&#x27;#cfcfcf&#x27;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;icon&#x27;</span> /&gt;</span> :</span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">ArrowUp</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&#x27;#cfcfcf&#x27;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;icon&#x27;</span> /&gt;</span></span><br><span class="language-xml">          &#125;</span><br><span class="language-xml">          &#123;/* <span class="hljs-tag">&lt;<span class="hljs-name">ArrowDown</span> /&gt;</span> */&#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;line&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">        &#123;/* 最后一个元素，arr.length=index */&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;showtodo&#x27;</span>&gt;</span></span><br><span class="language-xml">          &#123;</span><br><span class="language-xml">            queueInfo.length &gt; 0 ? (<span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;mb20&#x27;</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span>  当前班次：&#123;queueInfo[0].name&#125;</span><br><span class="language-xml">                &#123;numTime(queueInfo[0].startWorkTime.hour, queueInfo[0].startWorkTime.minute)&#125;</span><br><span class="language-xml">                -&#123;numTime(queueInfo[0].workTimes[0].restTimes[0].startTime.hour, queueInfo[0].workTimes[0].restTimes[0].startTime.minute)&#125;</span><br><span class="language-xml">                &#123;&#x27; &#x27;&#125;</span><br><span class="language-xml">                &#123;numTime(queueInfo[0].workTimes[0].restTimes[0].endTime.hour, queueInfo[0].workTimes[0].restTimes[0].endTime.minute)&#125;</span><br><span class="language-xml">                -&#123;numTime(queueInfo[0].endWorkTime.hour, queueInfo[0].endWorkTime.minute)&#125;</span><br><span class="language-xml"></span><br><span class="language-xml">              <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span>出勤统计：打卡&#123;dakaRecord &amp;&amp; dakaRecord.length || 0&#125;次</span><br><span class="language-xml">                &#123;/* ，工时32小时 */&#125;</span><br><span class="language-xml">              <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span>) : (</span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;mb20&#x27;</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span>当前班次： 当日无排班<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span>出勤统计： 当日无出勤<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">            )</span><br><span class="language-xml">          &#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">            &#123;</span><br><span class="language-xml">              dakaRecord &amp;&amp; dakaRecord.length &gt; 0 ? dakaRecord.map((item, index) =&gt; &#123;</span><br><span class="language-xml">                return (</span><br><span class="language-xml">                  <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.id&#125;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;ys-list&#x27;</span> &gt;</span></span><br><span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;index</span> + <span class="hljs-attr">1</span> === <span class="hljs-string">dakaRecord.length</span> ? &#x27;<span class="hljs-attr">des-mes</span> <span class="hljs-attr">des-none</span>&#x27; <span class="hljs-attr">:</span> &#x27; <span class="hljs-attr">des-mes</span>&#x27;&#125;&gt;</span></span><br><span class="language-xml">                      <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;list-dot&#x27;</span>&gt;</span></span><br><span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;dot&#x27;</span> /&gt;</span></span><br><span class="language-xml">                      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">                      <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;move&#x27;</span>&gt;</span></span><br><span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;xbjd&#x27;</span>&gt;</span>打卡时间：&#123;dayjs(item.createTime).format(&#x27;HH:mm:ss&#x27;)&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span><br><span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;lbox&#x27;</span>&gt;</span></span><br><span class="language-xml">                          &#123;</span><br><span class="language-xml">                            item.userAddress ? (</span><br><span class="language-xml">                              <span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">                                <span class="hljs-tag">&lt;<span class="hljs-name">Location</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;mr5&#x27;</span> /&gt;</span></span><br><span class="language-xml">                                <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>&#123;item.userAddress&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span><br><span class="language-xml">                              <span class="hljs-tag">&lt;/&gt;</span></span><br><span class="language-xml">                            ) : (</span><br><span class="language-xml">                              <span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">                                <span class="hljs-tag">&lt;<span class="hljs-name">Checked</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;mr5&#x27;</span> /&gt;</span></span><br><span class="language-xml">                                <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>Wifi打卡<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span><br><span class="language-xml">                              <span class="hljs-tag">&lt;/&gt;</span></span><br><span class="language-xml">                            )</span><br><span class="language-xml">                          &#125;</span><br><span class="language-xml">                        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">                      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">                  <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">                )</span><br><span class="language-xml">              &#125;) : (</span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">Empty</span>&gt;</span></span><br><span class="language-xml">                  <span class="hljs-tag">&lt;<span class="hljs-name">Empty.Image</span> /&gt;</span></span><br><span class="language-xml">                  <span class="hljs-tag">&lt;<span class="hljs-name">Empty.Description</span>&gt;</span>暂无打卡记录<span class="hljs-tag">&lt;/<span class="hljs-name">Empty.Description</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">Empty</span>&gt;</span></span><br><span class="language-xml">              )</span><br><span class="language-xml">            &#125;</span><br><span class="language-xml">            &#123;/* <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;ys-list&#x27;</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;des-mes lastCld&#x27;</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;list-dot&#x27;</span>&gt;</span></span><br><span class="language-xml">                  <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;dot&#x27;</span> /&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;move&#x27;</span>&gt;</span></span><br><span class="language-xml">                  <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;xbjd&#x27;</span>&gt;</span>下班12:06<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span><br><span class="language-xml">                  <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;lbox&#x27;</span>&gt;</span></span><br><span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">Info</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;mr5&#x27;</span> /&gt;</span></span><br><span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>下班时间12:00，早退14分<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span><br><span class="language-xml">                  <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">                  <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;lbox &#x27;</span>&gt;</span></span><br><span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">Location</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;mr5&#x27;</span> /&gt;</span></span><br><span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>重庆两江数字经济产业园.二期两江数字经济产业园.二</span><br><span class="language-xml">                      期两江数字经济产业园.二期<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span><br><span class="language-xml">                  <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">                  <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;yc&#x27;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setOpen(true)&#125;&gt;</span><br><span class="language-xml">                    处理异常</span><br><span class="language-xml">                  <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span> */&#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>        &lt;/<span class="hljs-title class_">View</span>&gt;<br>      &lt;/<span class="hljs-title class_">View</span>&gt;<br>    )<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">ActionSheetWithDescription</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ActionSheet</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">open</span>=<span class="hljs-string">&#123;open&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onSelect</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setOpen(false)&#125;</span><br><span class="language-xml">        onCancel=&#123;() =&gt; setOpen(false)&#125;</span><br><span class="language-xml">        onClose=&#123;setOpen&#125;</span><br><span class="language-xml">      &gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">ActionSheet.Header</span>&gt;</span>请选择您要提交的审批单<span class="hljs-tag">&lt;/<span class="hljs-name">ActionSheet.Header</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">ActionSheet.Action</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;补卡&quot;</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">ActionSheet.Action</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;2&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;请假&quot;</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">ActionSheet.Action</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;3&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;外勤&quot;</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">ActionSheet.Action</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;3&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;出差&quot;</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">ActionSheet.Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;cancel&quot;</span>&gt;</span>取消<span class="hljs-tag">&lt;/<span class="hljs-name">ActionSheet.Button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ActionSheet</span>&gt;</span></span><br>    )<br>  &#125;<br><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">toTongji</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">navigateTo</span>(&#123;<br>      <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/packageB/clockInOther/statisticalData/index&#x27;</span><br>    &#125;)<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;calendarCon&#x27;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;topBg&#x27;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;all&#x27;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;toTongji&#125;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;dpf&#x27;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;text&#x27;</span>&gt;</span></span><br><span class="language-xml">            &#123;toChineseNum(dayjs().format(&#x27;M&#x27;))&#125;</span><br><span class="language-xml">            月考勤汇总</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Arrow</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;stat&#x27;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;t&#x27;</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;b&#x27;</span>&gt;</span>迟到<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;t&#x27;</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;b&#x27;</span>&gt;</span>早退<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;t&#x27;</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;b&#x27;</span>&gt;</span>缺卡<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;t&#x27;</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;b&#x27;</span>&gt;</span>加班<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">      &#123;CustomDayCalendar()&#125;</span><br><span class="language-xml">      &#123;</span><br><span class="language-xml">        ActionSheetWithDescription()</span><br><span class="language-xml">      &#125;</span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>  )<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Index</span><br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>深度返回对象指定键值</title>
    <link href="/2022/05/22/%E6%B7%B1%E5%BA%A6%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1%E6%8C%87%E5%AE%9A%E9%94%AE%E5%80%BC/"/>
    <url>/2022/05/22/%E6%B7%B1%E5%BA%A6%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1%E6%8C%87%E5%AE%9A%E9%94%AE%E5%80%BC/</url>
    
    <content type="html"><![CDATA[<h3 id="深层次返回数据处理"><a href="#深层次返回数据处理" class="headerlink" title="深层次返回数据处理"></a>深层次返回数据处理</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">deepObj</span>(<span class="hljs-params">obj, key</span>) &#123;<br>  <span class="hljs-comment">// 一级对象里面的值</span><br>  <span class="hljs-keyword">if</span> (obj[key]) &#123;<br>    <span class="hljs-keyword">let</span> res = obj,<br>      curr,<br>      keys = key.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;.&quot;</span>);<br>    <span class="hljs-keyword">while</span> (curr = keys.<span class="hljs-title function_">shift</span>()) &#123;<br>      <span class="hljs-keyword">if</span> (!res[curr]) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;undefined&quot;</span><br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        res = res[curr]<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> res;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">val</span>: <span class="hljs-built_in">any</span><br>    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(obj).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">any</span></span>) =&gt;</span> &#123;<br>      <span class="hljs-comment">// 二级对象里面的值</span><br>      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(item).<span class="hljs-title function_">slice</span>(<span class="hljs-number">8</span>, -<span class="hljs-number">1</span>) === <span class="hljs-string">&#x27;Object&#x27;</span> &amp;&amp; item[key]) &#123;<br>        val = item[key]<br>      &#125;<br>    &#125;)<br>    <span class="hljs-comment">// console.log(val);</span><br>    <span class="hljs-keyword">return</span> val<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>时间范围处理</title>
    <link href="/2022/05/02/%E6%97%B6%E9%97%B4%E8%8C%83%E5%9B%B4%E5%A4%84%E7%90%86/"/>
    <url>/2022/05/02/%E6%97%B6%E9%97%B4%E8%8C%83%E5%9B%B4%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h3 id="比较当前时间是否在今日指定时间段内"><a href="#比较当前时间是否在今日指定时间段内" class="headerlink" title="比较当前时间是否在今日指定时间段内"></a>比较当前时间是否在今日指定时间段内</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> dayjs <span class="hljs-keyword">from</span> &quot;dayjs&quot;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">* [isDuringDate 比较当前时间是否在今日指定时间段内]</span><br><span class="hljs-comment">* @author yjw</span><br><span class="hljs-comment">* @param    date   [h] [今日几时开始,h]</span><br><span class="hljs-comment">* @param    date   [endDateStr]   [今日几时结束,h]</span><br><span class="hljs-comment">* @return   Boolean</span><br><span class="hljs-comment">*/</span><br>export <span class="hljs-keyword">function</span> isDuringDate(h, m, <span class="hljs-keyword">type</span>, cb) &#123;<br>  let curDate = <span class="hljs-built_in">new</span> <span class="hljs-type">Date</span>()<br>  let baseTime = <span class="hljs-built_in">new</span> <span class="hljs-type">Date</span>(dayjs(dayjs().format(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>)).<span class="hljs-keyword">add</span>(h, <span class="hljs-string">&#x27;hour&#x27;</span>).<span class="hljs-keyword">add</span>(m, <span class="hljs-string">&#x27;minute&#x27;</span>).format(<span class="hljs-string">&#x27;YYYY/MM/DD HH:mm:ss&#x27;</span>))<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&#x27;start&#x27;</span>) &#123;<br>    const otherTime = <span class="hljs-built_in">new</span> <span class="hljs-type">Date</span>(dayjs(dayjs().format(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>)).<span class="hljs-keyword">add</span>(h - <span class="hljs-number">4</span>, <span class="hljs-string">&#x27;hour&#x27;</span>).format(<span class="hljs-string">&#x27;YYYY/MM/DD HH:mm:ss&#x27;</span>))<br>    <span class="hljs-keyword">if</span> (curDate &gt;= otherTime &amp;&amp; curDate &lt;= baseTime) &#123;<br>      // <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>      cb(<span class="hljs-keyword">true</span>)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      // <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span><br>      cb(<span class="hljs-keyword">false</span>)<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    const otherTime = <span class="hljs-built_in">new</span> <span class="hljs-type">Date</span>(dayjs(dayjs().format(<span class="hljs-string">&#x27;YYYY-MM-DD&#x27;</span>)).<span class="hljs-keyword">add</span>(h + <span class="hljs-number">4</span>, <span class="hljs-string">&#x27;hour&#x27;</span>).format(<span class="hljs-string">&#x27;YYYY/MM/DD HH:mm:ss&#x27;</span>))<br>    <span class="hljs-keyword">if</span> (curDate &gt;= baseTime &amp;&amp; curDate &lt;= otherTime) &#123;<br>      // <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>      cb(<span class="hljs-keyword">true</span>)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      cb(<span class="hljs-keyword">false</span>)<br>      // <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>如何一次性渲染10w条数据</title>
    <link href="/2022/04/02/%E5%A6%82%E4%BD%95%E4%B8%80%E6%AC%A1%E6%80%A7%E6%B8%B2%E6%9F%9310w%E6%9D%A1%E6%95%B0%E6%8D%AE/"/>
    <url>/2022/04/02/%E5%A6%82%E4%BD%95%E4%B8%80%E6%AC%A1%E6%80%A7%E6%B8%B2%E6%9F%9310w%E6%9D%A1%E6%95%B0%E6%8D%AE/</url>
    
    <content type="html"><![CDATA[<ul><li>将数据分页，利用分页的原理，每次服务器端只返回一定数目的数据，浏览器每次只对一部分进行加载。</li><li>使用懒加载的方法，每次加载一部分数据，其余数据当需要使用时再去加载。</li><li>使用数组分块技术，基本思路是为要处理的项目创建一个队列，然后设置定时器每过一段时间取出一部分数据，然后再使用定时器取出下一个要处理的项目进行处理，接着再设置另一个定时器。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">renderList</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">&#x27;列表时间&#x27;</span>)<br>    <span class="hljs-keyword">const</span> list = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getList</span>()<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(list)<br>    <span class="hljs-keyword">const</span> total = list.<span class="hljs-property">length</span><br>    <span class="hljs-keyword">const</span> page = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">const</span> limit = <span class="hljs-number">200</span><br>    <span class="hljs-keyword">const</span> totalPage = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(total / limit)<br>    <br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">render</span> = (<span class="hljs-params">page</span>) =&gt; &#123;<br>     <span class="hljs-keyword">if</span> (page &gt;= totalPage) <span class="hljs-keyword">return</span><br>     <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = page * limit; i &lt; page * limit + limit; i++) &#123;<br>            <span class="hljs-keyword">const</span> item = list[i]<br>            <span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;div&#x27;</span>)<br>            div.<span class="hljs-property">className</span> = <span class="hljs-string">&#x27;sunshine&#x27;</span><br>            div.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`&lt;img src=&quot;<span class="hljs-subst">$&#123;item.src&#125;</span>&quot; /&gt;&lt;span&gt;<span class="hljs-subst">$&#123;item.text&#125;</span>&lt;/span&gt;`</span><br>            container.<span class="hljs-title function_">appendChild</span>(div)<br>        &#125;<br>        <span class="hljs-title function_">render</span>(page + <span class="hljs-number">1</span>)<br>    &#125;, <span class="hljs-number">0</span>)<br>&#125;<br><span class="hljs-title function_">render</span>(page)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">&#x27;列表时间&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>base64图片转png</title>
    <link href="/2022/03/01/BASE64%E5%9B%BE%E7%89%87%E8%BD%ACPNG/"/>
    <url>/2022/03/01/BASE64%E5%9B%BE%E7%89%87%E8%BD%ACPNG/</url>
    
    <content type="html"><![CDATA[<h3 id="base64图片转png"><a href="#base64图片转png" class="headerlink" title="base64图片转png"></a>base64图片转png</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">base64src</span>(<span class="hljs-params">base64data, cb</span>) &#123;<br>  <span class="hljs-keyword">const</span> fsm = <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">getFileSystemManager</span>();<br>  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FILE_BASE_NAME</span> = <span class="hljs-string">&#x27;tmp_base64src&#x27;</span>;<br>  <span class="hljs-keyword">const</span> qs = <span class="hljs-regexp">/data:image\/(\w+);base64,(.*)/</span>.<span class="hljs-title function_">exec</span>(base64data) || [];<br>  <span class="hljs-keyword">const</span> [, format, bodyData] = <span class="hljs-regexp">/data:image\/(\w+);base64,(.*)/</span>.<span class="hljs-title function_">exec</span>(base64data) || [];<br>  <span class="hljs-keyword">if</span> (!format) &#123;<br>    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;ERROR_BASE64SRC_PARSE&#x27;</span>));<br>  &#125;<br>  <span class="hljs-keyword">const</span> filePath = <span class="hljs-string">`<span class="hljs-subst">$&#123;Taro.env.USER_DATA_PATH&#125;</span>/<span class="hljs-subst">$&#123;FILE_BASE_NAME&#125;</span>.<span class="hljs-subst">$&#123;format&#125;</span>`</span>;<br>  <span class="hljs-keyword">const</span> buffer = <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">base64ToArrayBuffer</span>(bodyData);<br>  <span class="hljs-comment">// console.log(&#x27;filePath&#x27;, filePath, &#x27;buffer&#x27;, buffer)</span><br>  fsm.<span class="hljs-title function_">writeFile</span>(&#123;<br>    filePath,<br>    <span class="hljs-attr">data</span>: buffer,<br>    <span class="hljs-attr">encoding</span>: <span class="hljs-string">&#x27;binary&#x27;</span>,<br>    <span class="hljs-title function_">success</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title function_">upload</span>(filePath).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res: any</span>) =&gt;</span> &#123;<br>        <span class="hljs-comment">// console.log(JSON.parse(res.data), &#x27;uploadData&#x27;);</span><br>        <span class="hljs-title function_">cb</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(res.<span class="hljs-property">data</span>).<span class="hljs-property">data</span>.<span class="hljs-property">url</span>);<br>      &#125;)<br>    &#125;,<br>    <span class="hljs-title function_">fail</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">return</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;ERROR_BASE64SRC_WRITE&#x27;</span>));<br>    &#125;,<br>  &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>递归深拷贝</title>
    <link href="/2022/02/02/%E6%B7%B1%E6%8B%B7%E8%B4%9D/"/>
    <url>/2022/02/02/%E6%B7%B1%E6%8B%B7%E8%B4%9D/</url>
    
    <content type="html"><![CDATA[<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">function</span> deep<span class="hljs-constructor">Copy(<span class="hljs-params">object</span>)</span> &#123;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">object</span><span class="hljs-operator"> || </span>typeof <span class="hljs-keyword">object</span> !== <span class="hljs-string">&quot;object&quot;</span>) return <span class="hljs-keyword">object</span>;<br><br>  <span class="hljs-keyword">let</span> newObject = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Array</span>.</span></span>is<span class="hljs-constructor">Array(<span class="hljs-params">object</span>)</span> ? <span class="hljs-literal">[]</span> : &#123;&#125;;<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> <span class="hljs-keyword">object</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">object</span>.has<span class="hljs-constructor">OwnProperty(<span class="hljs-params">key</span>)</span>) &#123;<br>      newObject<span class="hljs-literal">[<span class="hljs-identifier">key</span>]</span> = deep<span class="hljs-constructor">Copy(<span class="hljs-params">object</span>[<span class="hljs-params">key</span>])</span>;<br>    &#125;<br>  &#125;<br><br>  return newObject;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>继承</title>
    <link href="/2022/02/02/%E7%BB%A7%E6%89%BF/"/>
    <url>/2022/02/02/%E7%BB%A7%E6%89%BF/</url>
    
    <content type="html"><![CDATA[<ul><li>原型链继承<br>.父类实例赋给子类原型prototype,<code>S.prototype = new F()</code></li><li>构造函数实现继承<br>.子类构造函数中call调用父类构造函数,<code>function Child()&#123;Father.call(this)&#125;</code></li><li>组合继承<br>.原型联继承+构造继承</li><li>寄生式组合继承<br>.创建空函数获取父类原型的副本。寄生式组合继承写法上和组合继承基本类似<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) &#123;<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Student</span>(<span class="hljs-params">name，age</span>) &#123;<br>  <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name)<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age<br>&#125;<br><span class="hljs-title class_">Student</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> =<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)<br><span class="hljs-title class_">Student</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Student</span><br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Promise</title>
    <link href="/2021/08/09/Promise/"/>
    <url>/2021/08/09/Promise/</url>
    
    <content type="html"><![CDATA[<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><ul><li><p>Promise 对象是异步编程的一种解决方案，最早由社区提出。Promises/A+ 规范是 JavaScript Promise 的标准，规定了一个 Promise 所必须具有的特性。</p></li><li><p>Promise 是一个构造函数，接收一个函数作为参数，返回一个 Promise 实例。一个 Promise 实例有三种状态，分别是 pending、resolved 和rejected，分别代表了进行中、已成功和已失败。实例的状态只能由 pending 转变 resolved 或者 rejected 状态，并且状态一经改变，就凝固了，无法再被改变了。状态的改变是通过 resolve() 和 reject() 函数来实现的，我们可以在异步操作结束后调用这两个函数改变 Promise 实例的状态，它的原型上定义了一个 then 方法，使用这个 then 方法可以为两个状态的改变注册回调函数。这个回调函数属于微任务，会在本轮事件循环的末尾执行。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PENDING</span> = <span class="hljs-string">&quot;pending&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">RESOLVED</span> = <span class="hljs-string">&quot;resolved&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">REJECTED</span> = <span class="hljs-string">&quot;rejected&quot;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyPromise</span>(<span class="hljs-params">fn</span>) &#123;<br>  <span class="hljs-comment">// 保存初始化状态</span><br>  <span class="hljs-keyword">var</span> self = <span class="hljs-variable language_">this</span>;<br><br>  <span class="hljs-comment">// 初始化状态</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = <span class="hljs-variable constant_">PENDING</span>;<br><br>  <span class="hljs-comment">// 用于保存 resolve 或者 rejected 传入的值</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>;<br><br>  <span class="hljs-comment">// 用于保存 resolve 的回调函数</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolvedCallbacks</span> = [];<br><br>  <span class="hljs-comment">// 用于保存 reject 的回调函数</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">rejectedCallbacks</span> = [];<br><br>  <span class="hljs-comment">// 状态转变为 resolved 方法</span><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-params">value</span>) &#123;<br>    <span class="hljs-comment">// 判断传入元素是否为 Promise 值，如果是，则状态改变必须等待前一个状态改变后再进行改变</span><br>    <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyPromise</span>) &#123;<br>      <span class="hljs-keyword">return</span> value.<span class="hljs-title function_">then</span>(resolve, reject);<br>    &#125;<br><br>    <span class="hljs-comment">// 保证代码的执行顺序为本轮事件循环的末尾</span><br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-comment">// 只有状态为 pending 时才能转变，</span><br>      <span class="hljs-keyword">if</span> (self.<span class="hljs-property">state</span> === <span class="hljs-variable constant_">PENDING</span>) &#123;<br>        <span class="hljs-comment">// 修改状态</span><br>        self.<span class="hljs-property">state</span> = <span class="hljs-variable constant_">RESOLVED</span>;<br><br>        <span class="hljs-comment">// 设置传入的值</span><br>        self.<span class="hljs-property">value</span> = value;<br><br>        <span class="hljs-comment">// 执行回调函数</span><br>        self.<span class="hljs-property">resolvedCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> &#123;<br>          <span class="hljs-title function_">callback</span>(value);<br>        &#125;);<br>      &#125;<br>    &#125;, <span class="hljs-number">0</span>);<br>  &#125;<br><br>  <span class="hljs-comment">// 状态转变为 rejected 方法</span><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">reject</span>(<span class="hljs-params">value</span>) &#123;<br>    <span class="hljs-comment">// 保证代码的执行顺序为本轮事件循环的末尾</span><br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-comment">// 只有状态为 pending 时才能转变</span><br>      <span class="hljs-keyword">if</span> (self.<span class="hljs-property">state</span> === <span class="hljs-variable constant_">PENDING</span>) &#123;<br>        <span class="hljs-comment">// 修改状态</span><br>        self.<span class="hljs-property">state</span> = <span class="hljs-variable constant_">REJECTED</span>;<br><br>        <span class="hljs-comment">// 设置传入的值</span><br>        self.<span class="hljs-property">value</span> = value;<br><br>        <span class="hljs-comment">// 执行回调函数</span><br>        self.<span class="hljs-property">rejectedCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> &#123;<br>          <span class="hljs-title function_">callback</span>(value);<br>        &#125;);<br>      &#125;<br>    &#125;, <span class="hljs-number">0</span>);<br>  &#125;<br><br>  <span class="hljs-comment">// 将两个方法传入函数执行</span><br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-title function_">fn</span>(resolve, reject);<br>  &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>    <span class="hljs-comment">// 遇到错误时，捕获错误，执行 reject 函数</span><br>    <span class="hljs-title function_">reject</span>(e);<br>  &#125;<br>&#125;<br><br><span class="hljs-title class_">MyPromise</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">then</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">onResolved, onRejected</span>) &#123;<br>  <span class="hljs-comment">// 首先判断两个参数是否为函数类型，因为这两个参数是可选参数</span><br>  onResolved =<br>    <span class="hljs-keyword">typeof</span> onResolved === <span class="hljs-string">&quot;function&quot;</span><br>      ? onResolved<br>      : <span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) &#123;<br>          <span class="hljs-keyword">return</span> value;<br>        &#125;;<br><br>  onRejected =<br>    <span class="hljs-keyword">typeof</span> onRejected === <span class="hljs-string">&quot;function&quot;</span><br>      ? onRejected<br>      : <span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) &#123;<br>          <span class="hljs-keyword">throw</span> error;<br>        &#125;;<br><br>  <span class="hljs-comment">// 如果是等待状态，则将函数加入对应列表中</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> === <span class="hljs-variable constant_">PENDING</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolvedCallbacks</span>.<span class="hljs-title function_">push</span>(onResolved);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rejectedCallbacks</span>.<span class="hljs-title function_">push</span>(onRejected);<br>  &#125;<br><br>  <span class="hljs-comment">// 如果状态已经凝固，则直接执行对应状态的函数</span><br><br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> === <span class="hljs-variable constant_">RESOLVED</span>) &#123;<br>    <span class="hljs-title function_">onResolved</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> === <span class="hljs-variable constant_">REJECTED</span>) &#123;<br>    <span class="hljs-title function_">onRejected</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>H5拍照上传裁剪总结</title>
    <link href="/2021/08/09/H5%E6%8B%8D%E7%85%A7%E4%B8%8A%E4%BC%A0%E8%A3%81%E5%89%AA%E5%B0%8F%E8%AE%B0/"/>
    <url>/2021/08/09/H5%E6%8B%8D%E7%85%A7%E4%B8%8A%E4%BC%A0%E8%A3%81%E5%89%AA%E5%B0%8F%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h3 id="拍照上传裁剪总结"><a href="#拍照上传裁剪总结" class="headerlink" title="拍照上传裁剪总结"></a>拍照上传裁剪总结</h3><ul><li><p>结合react的h5项目</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;input className<span class="hljs-operator">=</span>&#123;style.ipt&#125; type<span class="hljs-operator">=</span><span class="hljs-string">&quot;file&quot;</span> onChange<span class="hljs-operator">=</span>&#123;this.previewFile&#125; accept<span class="hljs-operator">=</span><span class="hljs-string">&quot;image/*&quot;</span> /&gt;<br></code></pre></td></tr></table></figure></li><li><p>ios存在照片上传旋转的问题<br>import * as EXIF from “exif-js”;//</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//  获取设备拍照方向</span><br>const previewFile =<span class="hljs-function"> (<span class="hljs-params">e</span>: <span class="hljs-params">any</span>) =&gt;</span> &#123;<br>    const fileObj = e.target.files<span class="hljs-literal">[<span class="hljs-number">0</span>]</span>;<br>    const img = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Image()</span>;<br>    img.src = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">URL</span>.</span></span>create<span class="hljs-constructor">ObjectURL(<span class="hljs-params">fileObj</span>)</span><br>    img.onload = <span class="hljs-keyword">function</span> <span class="hljs-literal">()</span> &#123;<br>      <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EXIF</span>.</span></span>get<span class="hljs-constructor">Data(<span class="hljs-params">fileObj</span>, <span class="hljs-params">function</span> ()</span> &#123;<br>        console.log(&#x27;getData&#x27;, file);<br>        <span class="hljs-comment">// 这里面可以看到值，想要什么直接获取即可。</span><br>        console.log(&#x27;getAllTags&#x27;, <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EXIF</span>.</span></span>get<span class="hljs-constructor">AllTags(<span class="hljs-params">file</span>)</span>.Orientation);<br>      &#125;);<br>    &#125;;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>结合canvas压缩照片</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">const previewFile =<span class="hljs-function"> (<span class="hljs-params">e</span>: <span class="hljs-params">any</span>) =&gt;</span> &#123;<br>    const file = e.target.files<span class="hljs-literal">[<span class="hljs-number">0</span>]</span>;<br>    const reader = <span class="hljs-keyword">new</span> <span class="hljs-constructor">FileReader()</span>;<br>    reader.add<span class="hljs-constructor">EventListener(<span class="hljs-string">&quot;load&quot;</span>, ()</span> =&gt; &#123;<br>      <span class="hljs-keyword">let</span> compressSrc = &#x27;&#x27;;<br>      const image = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Image()</span>; <span class="hljs-comment">//新建一个img标签（还没嵌入DOM节点)</span><br>      image.src = reader.result!.<span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span>;<br>      <span class="hljs-comment">// 超过2m压缩</span><br>      image.onload =<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (file.size &lt; <span class="hljs-number">1024</span><span class="hljs-operator"> * </span><span class="hljs-number">1024</span><span class="hljs-operator"> * </span><span class="hljs-number">2</span>) &#123;<br>          compressSrc = reader.result!.<span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          const canvas: any = document.create<span class="hljs-constructor">Element(&#x27;<span class="hljs-params">canvas</span>&#x27;)</span>;<br>          const context: any = canvas.get<span class="hljs-constructor">Context(&#x27;2d&#x27;)</span>;<br>          const imageWidth = image.width<span class="hljs-operator"> / </span><span class="hljs-number">2</span>;  <span class="hljs-comment">//压缩后图片的大小</span><br>          const imageHeight = image.height<span class="hljs-operator"> / </span><span class="hljs-number">2</span>;<br>          canvas.width = imageWidth;<br>          canvas.height = imageHeight;<br>          context.draw<span class="hljs-constructor">Image(<span class="hljs-params">image</span>, 0, 0, <span class="hljs-params">imageWidth</span>, <span class="hljs-params">imageHeight</span>)</span>;<br>          compressSrc = canvas.<span class="hljs-keyword">to</span><span class="hljs-constructor">DataURL(&#x27;<span class="hljs-params">image</span><span class="hljs-operator">/</span><span class="hljs-params">jpeg</span>&#x27;)</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>结合canvas旋转照片</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs mel"><span class="hljs-comment">// 旋转照片</span><br> public rotateBase64Img(src: any, edg: any, callback: any) &#123;<br>   const <span class="hljs-keyword">canvas</span> = document.createElement(<span class="hljs-string">&quot;canvas&quot;</span>);<br>   const ctx: any = <span class="hljs-keyword">canvas</span>.getContext(<span class="hljs-string">&quot;2d&quot;</span>);<br>   let imgW;<span class="hljs-comment">//图片宽度</span><br>   let imgH;<span class="hljs-comment">//图片高度</span><br>   let <span class="hljs-keyword">size</span>;<span class="hljs-comment">//canvas初始大小</span><br>   <span class="hljs-keyword">if</span> (edg % <span class="hljs-number">90</span> !== <span class="hljs-number">0</span>) &#123;<br>     console.<span class="hljs-keyword">error</span>(<span class="hljs-string">&quot;旋转角度必须是90的倍数!&quot;</span>);<br>     throw <span class="hljs-string">&#x27;旋转角度必须是90的倍数!&#x27;</span>;<br>   &#125;<br>   (edg &lt; <span class="hljs-number">0</span>) &amp;&amp; (edg = (edg % <span class="hljs-number">360</span>) + <span class="hljs-number">360</span>);<br>   const quadrant = (edg / <span class="hljs-number">90</span>) % <span class="hljs-number">4</span>; <span class="hljs-comment">//旋转象限</span><br>   const cutCoor = &#123; sx: <span class="hljs-number">0</span>, sy: <span class="hljs-number">0</span>, ex: <span class="hljs-number">0</span>, ey: <span class="hljs-number">0</span> &#125;; <span class="hljs-comment">//裁剪坐标</span><br>   const <span class="hljs-keyword">image</span> = new Image();<br>   <span class="hljs-keyword">image</span>.crossOrigin = <span class="hljs-string">&quot;anonymous&quot;</span>;<br>   <span class="hljs-keyword">image</span>.src = src;<br>   <span class="hljs-keyword">image</span>.onload = function () &#123;<br>     imgW = <span class="hljs-keyword">image</span>.width;<br>     imgH = <span class="hljs-keyword">image</span>.height;<br>     <span class="hljs-keyword">size</span> = imgW &gt; imgH ? imgW : imgH;<br>     <span class="hljs-keyword">canvas</span>.width = <span class="hljs-keyword">size</span> * <span class="hljs-number">2</span>;<br>     <span class="hljs-keyword">canvas</span>.height = <span class="hljs-keyword">size</span> * <span class="hljs-number">2</span>;<br>     <span class="hljs-keyword">switch</span> (quadrant) &#123;<br>       <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>         cutCoor.sx = <span class="hljs-keyword">size</span>;<br>         cutCoor.sy = <span class="hljs-keyword">size</span>;<br>         cutCoor.ex = <span class="hljs-keyword">size</span> + imgW;<br>         cutCoor.ey = <span class="hljs-keyword">size</span> + imgH;<br>         <span class="hljs-keyword">break</span>;<br>       <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>         cutCoor.sx = <span class="hljs-keyword">size</span> - imgH;<br>         cutCoor.sy = <span class="hljs-keyword">size</span>;<br>         cutCoor.ex = <span class="hljs-keyword">size</span>;<br>         cutCoor.ey = <span class="hljs-keyword">size</span> + imgW;<br>         <span class="hljs-keyword">break</span>;<br>       <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>         cutCoor.sx = <span class="hljs-keyword">size</span> - imgW;<br>         cutCoor.sy = <span class="hljs-keyword">size</span> - imgH;<br>         cutCoor.ex = <span class="hljs-keyword">size</span>;<br>         cutCoor.ey = <span class="hljs-keyword">size</span>;<br>         <span class="hljs-keyword">break</span>;<br>       <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>         cutCoor.sx = <span class="hljs-keyword">size</span>;<br>         cutCoor.sy = <span class="hljs-keyword">size</span> - imgW;<br>         cutCoor.ex = <span class="hljs-keyword">size</span> + imgH;<br>         cutCoor.ey = <span class="hljs-keyword">size</span> + imgW;<br>         <span class="hljs-keyword">break</span>;<br>     &#125;<br>     ctx.translate(<span class="hljs-keyword">size</span>, <span class="hljs-keyword">size</span>);<br>     ctx.<span class="hljs-keyword">rotate</span>(edg * Math.PI / <span class="hljs-number">180</span>);<br>     ctx.drawImage(<span class="hljs-keyword">image</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>     const imgData = ctx.getImageData(cutCoor.sx, cutCoor.sy, cutCoor.ex, cutCoor.ey);<br>     <span class="hljs-keyword">if</span> (quadrant % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>) &#123;<br>       <span class="hljs-keyword">canvas</span>.width = imgW;<br>       <span class="hljs-keyword">canvas</span>.height = imgH;<br>     &#125; <span class="hljs-keyword">else</span> &#123;<br>       <span class="hljs-keyword">canvas</span>.width = imgH;<br>       <span class="hljs-keyword">canvas</span>.height = imgW;<br>     &#125;<br>     ctx.putImageData(imgData, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>     callback(<span class="hljs-keyword">canvas</span>.toDataURL());<br>   &#125;;<br> &#125;<br></code></pre></td></tr></table></figure></li><li><p>ios型号判断相关</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">appVersion</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> appVersion = <span class="hljs-variable language_">window</span>.<span class="hljs-property">navigator</span>.<span class="hljs-property">appVersion</span>;<br>  <span class="hljs-keyword">return</span> appVersion;<br>&#125;;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">userAgent</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> userAgent = <span class="hljs-variable language_">window</span>.<span class="hljs-property">navigator</span>.<span class="hljs-property">userAgent</span>;<br>  <span class="hljs-keyword">return</span> userAgent;<br>&#125;;<br><span class="hljs-comment">//屏幕尺寸</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">isIphone678</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-regexp">/iphone/gi</span>.<span class="hljs-title function_">test</span>(navigator.<span class="hljs-property">userAgent</span>) &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">screen</span> &amp;&amp; (<span class="hljs-variable language_">window</span>.<span class="hljs-property">screen</span>.<span class="hljs-property">height</span> === <span class="hljs-number">667</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">screen</span>.<span class="hljs-property">width</span> === <span class="hljs-number">375</span>);<br><span class="hljs-keyword">export</span> co<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>杂项</title>
    <link href="/2021/07/07/Vue%E6%9D%82%E9%A1%B9/"/>
    <url>/2021/07/07/Vue%E6%9D%82%E9%A1%B9/</url>
    
    <content type="html"><![CDATA[<h3 id="Vue-的各个生命阶段是什么？"><a href="#Vue-的各个生命阶段是什么？" class="headerlink" title="Vue 的各个生命阶段是什么？"></a>Vue 的各个生命阶段是什么？</h3><p>Vue 一共有8个生命阶段，分别是创建前、创建后、加载前、加载后、更新前、更新后、销毁前和销毁后，每个阶段对应了一个生命周期的钩子函数。</p><p>（1）beforeCreate 钩子函数，在实例初始化之后，在数据监听和事件配置之前触发。因此在这个事件中我们是获取不到 data 数据的。</p><p>（2）created 钩子函数，在实例创建完成后触发，此时可以访问 data、methods 等属性。但这个时候组件还没有被挂载到页面中去，所以这个时候访问不到 $el 属性。一般我们可以在这个函数中进行一些页面初始化的工作，比如通过 ajax 请求数据来对页面进行初始化。</p><p>（3）beforeMount 钩子函数，在组件被挂载到页面之前触发。在 beforeMount 之前，会找到对应的 template，并编译成 render 函数。</p><p>（4）mounted 钩子函数，在组件挂载到页面之后触发。此时可以通过 DOM API 获取到页面中的 DOM 元素。</p><p>（5）beforeUpdate 钩子函数，在响应式数据更新时触发，发生在虚拟 DOM 重新渲染和打补丁之前，这个时候我们可以对可能会被移除的元素做一些操作，比如移除事件监听器。</p><p>（6）updated 钩子函数，虚拟 DOM 重新渲染和打补丁之后调用。</p><p>（7）beforeDestroy 钩子函数，在实例销毁之前调用。一般在这一步我们可以销毁定时器、解绑全局事件等。</p><p>（8）destroyed 钩子函数，在实例销毁之后调用，调用后，Vue 实例中的所有东西都会解除绑定，所有的事件监听器会被移除，所有的子实例也会被销毁。</p><p>当我们使用 keep-alive 的时候，还有两个钩子函数，分别是 activated 和 deactivated 。用 keep-alive 包裹的组件在切换时不会进行销毁，而是缓存到内存中并执行 deactivated 钩子函数，命中缓存渲染后会执行 actived 钩子函数。</p><h3 id="vue-router-中的导航钩子函数"><a href="#vue-router-中的导航钩子函数" class="headerlink" title="vue-router 中的导航钩子函数"></a>vue-router 中的导航钩子函数</h3><p>（1）全局的钩子函数 beforeEach 和 afterEach</p><p>beforeEach 有三个参数，to 代表要进入的路由对象，from 代表离开的路由对象。next 是一个必须要执行的函数，如果不传参数，那就执行下一个钩子函数，如果传入 false，则终止跳转，如果传入一个路径，则导航到对应的路由，如果传入 error ，则导航终止，error 传入错误的监听函数。</p><p>（2）单个路由独享的钩子函数 beforeEnter，它是在路由配置上直接进行定义的。</p><p>（3）组件内的导航钩子主要有这三种：beforeRouteEnter、beforeRouteUpdate、beforeRouteLeave。它们是直接在路由组<br>件内部直接进行定义的。</p><h3 id="route-和-router-的区别？"><a href="#route-和-router-的区别？" class="headerlink" title="$route 和 $router 的区别？"></a>$route 和 $router 的区别？</h3><p>$route 是“路由信息对象”，包括 path，params，hash，query，fullPath，matched，name 等路由信息参数。而 $router 是“路由实例”对象包括了路由的跳转方法，钩子函数</p><h3 id="keep-alive-组件有什么作用？"><a href="#keep-alive-组件有什么作用？" class="headerlink" title="keep-alive 组件有什么作用？"></a>keep-alive 组件有什么作用？</h3><p>如果你需要在组件切换的时候，保存一些组件的状态防止多次渲染，就可以使用 keep-alive 组件包裹需要保存的组件。</p><h3 id="vue-中-key-值的作用？"><a href="#vue-中-key-值的作用？" class="headerlink" title="vue 中 key 值的作用？"></a>vue 中 key 值的作用？</h3><p>vue 中 key 值的作用可以分为两种情况来考虑。</p><p>1.第一种情况是 v-if 中使用 key。由于 Vue 会尽可能高效地渲染元素，通常会复用已有元素而不是从头开始渲染。因此当我们使用 v-if 来实现元素切换的时候，如果切换前后含有相同类型的元素，那么这个元素就会被复用。如果是相同的 input 元素，那么切换前后用户的输入不会被清除掉，这样是不符合需求的。因此我们可以通过使用 key 来唯一的标识一个元素，这个情况下，使用 key 的元素不会被复用。这个时候 key 的作用是用来标识一个独立的元素。</p><p>2.第二种情况是 v-for 中使用 key。用 v-for 更新已渲染过的元素列表时，它默认使用“就地复用”的策略。如果数据项的顺序发生了改变，Vue 不会移动 DOM 元素来匹配</p><h3 id="computed-和-watch-的差异？"><a href="#computed-和-watch-的差异？" class="headerlink" title="computed 和 watch 的差异？"></a>computed 和 watch 的差异？</h3><p>（1）computed 是计算一个新的属性，并将该属性挂载到 Vue 实例上，而 watch 是监听已经存在且已挂载到 Vue 实例上的数据，所以用 watch 同样可以监听 computed 计算属性的变化。</p><p>（2）computed 本质是一个惰性求值的观察者，具有缓存性，只有当依赖变化后，第一次访问 computed 属性，才会计算新的值。而 watch 则是当数据发生变化便会调用执行函数。</p><p>（3）从使用场景上说，computed 适用一个数据被多个数据影响，而 watch 适用一个数据影响多个数据。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Vue组件间的参数传递</title>
    <link href="/2021/07/07/Vue%E7%BB%84%E4%BB%B6%E9%97%B4%E7%9A%84%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92/"/>
    <url>/2021/07/07/Vue%E7%BB%84%E4%BB%B6%E9%97%B4%E7%9A%84%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92/</url>
    
    <content type="html"><![CDATA[<ul><li>父子组件间通信</li></ul><p>第一种方法是子组件通过 props 属性来接受父组件的数据，然后父组件在子组件上注册监听事件，子组件通过 emit 触发事<br>件来向父组件发送数据。</p><p>第二种是通过 ref 属性给子组件设置一个名字。父组件通过 $refs 组件名来获得子组件，子组件通过 $parent 获得父组<br>件，这样也可以实现通信。</p><p>第三种是使用 provider/inject，在父组件中通过 provider 提供变量，在子组件中通过 inject 来将变量注入到组件<br>中。不论子组件有多深，只要调用了 inject 那么就可以注入 provider 中的数据。</p><ul><li>兄弟组件间通信</li></ul><p>第一种是使用 eventBus 的方法，它的本质是通过创建一个空的 Vue 实例来作为消息传递的对象，通信的组件引入这个实<br>例，通信的组件通过在这个实例上监听和触发事件，来实现消息的传递。</p><p>第二种是通过 $parent.$refs 来获取到兄弟组件，也可以进行通信。</p><ul><li>任意组件之间</li></ul><p>使用 eventBus ，其实就是创建一个事件中心，相当于中转站，可以用它来传递事件和接收事件。</p><ul><li>如果业务逻辑复杂，很多组件之间需要同时处理一些公共的数据，这个时候采用上面这一些方法可能不利于项目的维护。这个时候<br>可以使用 vuex ，vuex 的思想就是将这一些公共的数据抽离出来，将它作为一个全局的变量来管理，然后其他组件就可以对这个<br>公共数据进行读写操作，这样达到了解耦的目的。</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>防抖节流</title>
    <link href="/2021/03/02/%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81/"/>
    <url>/2021/03/02/%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81/</url>
    
    <content type="html"><![CDATA[<ol><li><ul><li>防抖：事件触发n秒后再执行的回调 -&gt;延迟执行； n秒内再次触发事件重新开始执行</li><li>input框变化频繁触发事件可加防抖；频繁点击按钮提交表单可加防抖；电脑息屏时间，每动一次电脑又重新计算时间<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">doAdd</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>   <span class="hljs-keyword">let</span> num = <span class="hljs-number">0</span><br>   <span class="hljs-keyword">let</span> time = <span class="hljs-literal">null</span><br>   <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>     <span class="hljs-keyword">if</span> (time) &#123;<br>       <span class="hljs-built_in">clearTimeout</span>(time)<br>       time = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>         num++;<br>         <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num);<br>       &#125;, <span class="hljs-number">1000</span>)<br>     &#125; <span class="hljs-keyword">else</span> &#123;<br>       time = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>         num++;<br>         <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num);<br>       &#125;, <span class="hljs-number">1000</span>)<br>     &#125;<br>   &#125;<br> &#125;<br></code></pre></td></tr></table></figure></li></ul></li><li><ul><li>节流：事件触发，n秒内只执行一次</li><li>滚动频繁请求列表可加节流；游戏里长按鼠标，但是动作都是每隔一段时间做一次</li></ul></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">doAdd2</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">let</span> num2 = <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">let</span> timer2 = <span class="hljs-literal">null</span>;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>          <span class="hljs-keyword">if</span> (timer2) &#123;<br>              <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>              timer2 = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>                  num2++;<br>                  txt2.<span class="hljs-property">innerHTML</span> = num2;<br>                  <span class="hljs-built_in">clearTimeout</span>(timer2)<br>                  timer2 = <span class="hljs-literal">null</span><br>              &#125;, <span class="hljs-number">2000</span>)<br>          &#125;<br>      &#125;<br>  &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
